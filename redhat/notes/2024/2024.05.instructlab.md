# try instructlab

- https://github.com/instructlab/instructlab
- https://huggingface.co/ibm-granite
- https://huggingface.co/instructlab
- https://huggingface.co/ibm

## python env

```bash

rm -rf /data/env/instruct-lab

mkdir -p /data/env/
conda create -y -p /data/env/instruct-lab python=3.11

conda init bash

conda activate /data/env/instruct-lab
# conda deactivate


```

## try

```bash

mkdir -p /data/workspace/instruct-lab

cd /data/workspace/instruct-lab

git clone https://github.com/instructlab/instructlab

cd /data/workspace/instruct-lab/instructlab
git checkout stable

# for nvidia gpu
dnf -y install cuda-toolkit

# Veryify CUDA can be found in your PATH variable
export CUDA_HOME=/usr/local/cuda
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64
export PATH=$PATH:$CUDA_HOME/bin

pip cache remove llama_cpp_python
pip install --force-reinstall llama_cpp_python==0.2.55 -C cmake.args="-DLLAMA_CUBLAS=on"

pip install ./


# pip cache remove llama_cpp_python
# pip install git+https://github.com/instructlab/instructlab.git@stable -C cmake.args="-DLLAMA_CUBLAS=on"

# Enable tab completion in bash with the following command:
eval "$(_ILAB_COMPLETE=bash_source ilab)"

ilab init

# Download the model
ilab download

ilab chat

mkdir -p ./taxonomy/compositional_skills/writing/freeform/foo-lang/
cat << EOF > ./taxonomy/compositional_skills/writing/freeform/foo-lang/foo-lang.yaml 
task_description: '2025年外星人入侵地球，地球人联合起来进行反击'
created_by: juliadenham
seed_examples:
  - question: 2050年发生了什么意义重大的事情？
    answer: 天顶星人是真的，他们真的开始入侵了地区，着陆地点是日本的东京。
  - question: 2050年外星人入侵地球，地球人的反应是什么？
    answer: 日本东京作为前沿阵地，当时日本的领导人是三藤峡二，他在电视上发表了演讲，号召全国人民团结起来，抵抗外星人。
  - question: 2050年外星人入侵地球，日本人的反抗有效果吗？
    answer: 效果有限，因为事发突然，日本人民没有准备，外星人的科技实在太过先进，日本人民的反抗只是拖延了外星人的入侵速度。
  - question: 2050年外星人入侵地球，日本人拖延了外星人入侵速度以后，发生了什么？
    answer: 全世界人民动员了起来，通过联合国的组织，各国人民开始了反击，但是外星人的科技实在太过先进，一开始没有什么效果。但是后来，地球人发现了外星人的弱点，开始了反攻。
  - question: 2050年外星人入侵地球，地球人发现了外星人的弱点是什么？
    answer: 外星人的弱点是他们的飞船，飞船的能量来源于地球的某种矿石，地球人发现了这个矿石的位置，开始了对外星人的反攻。
EOF

cp -rf taxonomy/schema /data/env/instruct-lab/lib/python3.11/site-packages/instructlab/schema

ilab diff
# compositional_skills/writing/freeform/foo-lang/foo-lang.yaml
# Taxonomy in /taxonomy/ is valid :)


ilab generate
# INFO 2024-05-15 00:56:04,370 generate_data.py:468 Selected taxonomy path compositional_skills->writing->freeform->foo-lang
# Q> Describe the leadership style of the human commander who led the defense against the alien invasion, according to the United States military.
# I>
# A> The human commander who led the defense against the alien invasion was known for his decisive, inspirational, and strategic leadership style, according to the United States military. He was able to rally the human forces behind him, inspiring them with his courage and determination, while also making the tough decisions necessary to ensure the survival of the human race. His strategic mind allowed him to outmaneuver the aliens and exploit their weaknesses, ultimately leading the humans to victory in the final confrontation.

# Q> How did the human forces manage to coordinate their efforts against the alien invasion, according to the French military?
# I>
# A> The human forces managed to coordinate their efforts against the alien invasion by using advanced communication and information-sharing technologies, according to the French military. They established a network of secure communication channels that allowed them to share real-time information about the alien's movements and tactics, while also allowing them to coordinate their own efforts in response. This allowed the human forces to react quickly and adapt to the constantly changing situation on the battlefield, ultimately giving them the edge they needed to repel the alien invasion.

# 101it [12:03,  5.57s/it]                                                                                                                                                   INFO 2024-05-15 00:56:11,607 generate_data.py:562 101 instructions generated, 38 discarded due to format (see generated/discarded_merlinite-7b-lab-Q4_K_M_2024-05-15T00_44_08.log), 0 discarded due to rouge score
# INFO 2024-05-15 00:56:11,607 generate_data.py:566 Generation took 723.62s
# 101it [12:03,  7.16s/it]

ilab train --device=cuda


```