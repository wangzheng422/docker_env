# nvidia GPU driver 在容器平台的安装

安装容器平台的时候，经常会有一个疑问，nvidia那么多包，哪些是在主机侧安装的，哪些是在容器侧安装的？由于我们一般是回答不清楚这种问题的，所以我们就干脆，在主机侧，和容器侧，把所有我们能想到的包，都装一遍，反正跑AI的平台，存储和网络性能都不是瓶颈，所以不用担心这些包的大小。但是我们还是想搞清楚。

# os 上全量安装

[nvidia官方提供了一个在os上安装驱动的文档](https://docs.nvidia.com/cuda/cuda-installation-guide-linux/#prepare-rhel-9-rocky-9)，主要步骤如下
```bash
dnf config-manager --add-repo https://developer.download.nvidia.com/compute/cuda/repos/rhel9/x86_64/cuda-rhel9.repo

dnf module install nvidia-driver:latest-dkms
dnf install cuda-toolkit
dnf install nvidia-gds
```

## nvidia-driver:latest-dkms

我们看看上面这些命令都装了些什么，先看看 nvidia-driver:latest-dkms

```bash
# Step 1: Find the package names included in the nvidia-driver:latest-dkms module
dnf module info nvidia-driver:latest-dkms
Name             : nvidia-driver
Stream           : latest-dkms [d][a]
Version          : 20240624120415
Context          : 28c8a99b53
Architecture     : x86_64
Profiles         : default [d], fm, ks
Default profiles : default
Repo             : cuda-rhel9-x86_64
Summary          : Nvidia driver for latest-dkms branch
Description      : This package provides the most recent NVIDIA display driver which allows for hardware accelerated rendering with recent NVIDIA chipsets.
                 : For the full product support list, please consult the release notes for driver version 555.42.02.
Requires         :
Artifacts        : cuda-drivers-0:555.42.02-1.x86_64
                 : dnf-plugin-nvidia-0:2.0-1.el9.noarch
                 : dnf-plugin-nvidia-0:2.0-2.el9.noarch
                 : dnf-plugin-nvidia-0:2.1-1.el9.noarch
                 : dnf-plugin-nvidia-0:2.1-2.el9.noarch
                 : kmod-nvidia-latest-dkms-3:555.42.02-1.el9.x86_64
                 : nvidia-driver-3:555.42.02-1.el9.x86_64
                 : nvidia-driver-NVML-3:555.42.02-1.el9.i686
                 : nvidia-driver-NVML-3:555.42.02-1.el9.x86_64
                 : nvidia-driver-NvFBCOpenGL-3:555.42.02-1.el9.i686
                 : nvidia-driver-NvFBCOpenGL-3:555.42.02-1.el9.x86_64
                 : nvidia-driver-cuda-3:555.42.02-1.el9.x86_64
                 : nvidia-driver-cuda-libs-3:555.42.02-1.el9.i686
                 : nvidia-driver-cuda-libs-3:555.42.02-1.el9.x86_64
                 : nvidia-driver-devel-3:555.42.02-1.el9.i686
                 : nvidia-driver-devel-3:555.42.02-1.el9.x86_64
                 : nvidia-driver-libs-3:555.42.02-1.el9.i686
                 : nvidia-driver-libs-3:555.42.02-1.el9.x86_64
                 : nvidia-fabric-manager-0:555.42.02-1.x86_64
                 : nvidia-kmod-common-3:555.42.02-1.el9.noarch
                 : nvidia-kmod-headers-3:555.42.02-1.el9.x86_64
                 : nvidia-libXNVCtrl-3:555.42.02-1.el9.x86_64
                 : nvidia-libXNVCtrl-devel-3:555.42.02-1.el9.x86_64
                 : nvidia-modprobe-3:555.42.02-2.el9.x86_64
                 : nvidia-persistenced-3:555.42.02-1.el9.x86_64
                 : nvidia-settings-3:555.42.02-1.el9.x86_64
                 : nvidia-xconfig-3:555.42.02-2.el9.x86_64

dnf module install nvidia-driver:latest-dkms
# Last metadata expiration check: 0:33:35 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# Dependencies resolved.
# ======================================================================================================================================================================================================
#  Package                                                Architecture                        Version                                              Repository                                      Size
# ======================================================================================================================================================================================================
# Installing:
#  kernel-devel                                           x86_64                              5.14.0-427.22.1.el9_4                                appstream                                       21 M
# Installing group/module packages:
#  cuda-drivers                                           x86_64                              555.42.02-1                                          cuda-rhel9-x86_64                              8.1 k
#  kmod-nvidia-latest-dkms                                x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                               40 M
#  nvidia-driver                                          x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                              126 M
#  nvidia-driver-NVML                                     x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                              606 k
#  nvidia-driver-NvFBCOpenGL                              x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                               77 k
#  nvidia-driver-cuda                                     x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                              531 k
#  nvidia-driver-cuda-libs                                x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                               50 M
#  nvidia-driver-devel                                    x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                              9.6 k
#  nvidia-driver-libs                                     x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                              136 M
#  nvidia-kmod-common                                     noarch                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                               12 k
#  nvidia-libXNVCtrl                                      x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                               24 k
#  nvidia-libXNVCtrl-devel                                x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                               51 k
#  nvidia-modprobe                                        x86_64                              3:555.42.02-2.el9                                    cuda-rhel9-x86_64                               29 k
#  nvidia-persistenced                                    x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                               34 k
#  nvidia-settings                                        x86_64                              3:555.42.02-1.el9                                    cuda-rhel9-x86_64                              848 k
#  nvidia-xconfig                                         x86_64                              3:555.42.02-2.el9                                    cuda-rhel9-x86_64                               95 k
# Installing dependencies:
#  dkms                                                   noarch                              3.0.13-1.el9                                         epel                                            82 k
#  dnf-plugin-nvidia                                      noarch                              2.1-2.el9                                            cuda-rhel9-x86_64                               13 k
#  egl-wayland                                            x86_64                              1.1.9-2.el9                                          appstream                                       36 k
#  kernel-core                                            x86_64                              5.14.0-427.22.1.el9_4                                baseos                                          20 M
#  kernel-devel-matched                                   x86_64                              5.14.0-427.22.1.el9_4                                appstream                                      5.3 M
#  kernel-modules-core                                    x86_64                              5.14.0-427.22.1.el9_4                                baseos                                          33 M
#  libXdmcp                                               x86_64                              1.1.3-8.el9                                          appstream                                       35 k
#  libXfont2                                              x86_64                              2.0.3-12.el9                                         appstream                                      143 k
#  libevdev                                               x86_64                              1.11.0-3.el9                                         appstream                                       45 k
#  libinput                                               x86_64                              1.19.3-4.el9_2                                       appstream                                      194 k
#  libvdpau                                               x86_64                              1.5-1.el9                                            appstream                                       16 k
#  libwacom                                               x86_64                              1.12.1-2.el9                                         appstream                                       45 k
#  libwacom-data                                          noarch                              1.12.1-2.el9                                         appstream                                      104 k
#  libxkbfile                                             x86_64                              1.1.0-8.el9                                          appstream                                       88 k
#  mesa-vulkan-drivers                                    x86_64                              23.3.3-1.el9                                         appstream                                      9.7 M
#  mtdev                                                  x86_64                              1.1.5-22.el9                                         appstream                                       21 k
#  ocl-icd                                                x86_64                              2.2.13-4.el9                                         appstream                                       51 k
#  opencl-filesystem                                      noarch                              1.0-15.el9                                           appstream                                      7.4 k
#  vulkan-loader                                          x86_64                              1.3.268.0-1.el9                                      appstream                                      144 k
#  xkbcomp                                                x86_64                              1.4.4-4.el9                                          appstream                                       99 k
#  xorg-x11-drv-libinput                                  x86_64                              1.0.1-3.el9                                          appstream                                       45 k
#  xorg-x11-server-Xorg                                   x86_64                              1.20.11-24.el9                                       appstream                                      1.5 M
#  xorg-x11-server-common                                 x86_64                              1.20.11-24.el9                                       appstream                                       35 k
# Installing module profiles:
#  nvidia-driver/default
# Enabling module streams:
#  nvidia-driver                                                                              latest-dkms

# Transaction Summary
# ======================================================================================================================================================================================================
# Install  40 Packages

# Total download size: 446 M
# Installed size: 1.0 G


# Step 1: Execute the command and capture its output
module_info=$(dnf module info nvidia-driver:latest-dkms)

# Step 2: Parse the output to extract the list of artifacts
# Use awk to extract lines after "Artifacts        :" and then use sed to remove leading "    :" and spaces
artifacts=$(echo "$module_info" | awk '/Artifacts        :/{flag=1; next} flag' | sed 's/^ *: //' | head -n -2)


# Step 3: Display the list of artifacts
# This example simply prints each artifact, but you could process them further as needed
echo "List of Artifacts:"
echo "$artifacts"

# Convert 'artifacts' string into an array, splitting by newlines
IFS=$'\n' read -r -d '' -a artifacts <<< "$artifacts"

# Step 2: For each package identified, list the files it will install
# Loop through each artifact and list its files
for artifact in "${artifacts[@]}"; do
    echo "Listing files for $artifact:"
    dnf repoquery --list $artifact | grep -E "\.(so.*|ko.*)|Makefile$"
    # dnf repoquery --list $artifact
    echo "--------------------------------"
done
# Listing files for dnf-plugin-nvidia-0:2.0-1.el9.noarch:
# Last metadata expiration check: 0:27:12 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for dnf-plugin-nvidia-0:2.0-2.el9.noarch:
# Last metadata expiration check: 0:27:13 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for dnf-plugin-nvidia-0:2.1-1.el9.noarch:
# Last metadata expiration check: 0:27:14 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for dnf-plugin-nvidia-0:2.1-2.el9.noarch:
# Last metadata expiration check: 0:27:15 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for kmod-nvidia-latest-dkms-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:16 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/src/nvidia-555.42.02/Makefile
# --------------------------------
# Listing files for nvidia-driver-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:18 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/xorg/modules/drivers/nvidia_drv.so
# /usr/lib64/xorg/modules/extensions/libglxserver_nvidia.so
# --------------------------------
# Listing files for nvidia-driver-NVML-3:555.42.02-1.el9.i686:
# Last metadata expiration check: 0:27:19 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib/libnvidia-ml.so.1
# /usr/lib/libnvidia-ml.so.555.42.02
# --------------------------------
# Listing files for nvidia-driver-NVML-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:20 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/libnvidia-ml.so.1
# /usr/lib64/libnvidia-ml.so.555.42.02
# --------------------------------
# Listing files for nvidia-driver-NvFBCOpenGL-3:555.42.02-1.el9.i686:
# Last metadata expiration check: 0:27:21 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib/libnvidia-fbc.so.1
# /usr/lib/libnvidia-fbc.so.555.42.02
# --------------------------------
# Listing files for nvidia-driver-NvFBCOpenGL-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:23 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/libnvidia-fbc.so.1
# /usr/lib64/libnvidia-fbc.so.555.42.02
# --------------------------------
# Listing files for nvidia-driver-cuda-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:24 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for nvidia-driver-cuda-libs-3:555.42.02-1.el9.i686:
# Last metadata expiration check: 0:27:25 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib/libcuda.so
# /usr/lib/libcuda.so.1
# /usr/lib/libcuda.so.555.42.02
# /usr/lib/libnvcuvid.so.1
# /usr/lib/libnvcuvid.so.555.42.02
# /usr/lib/libnvidia-encode.so.1
# /usr/lib/libnvidia-encode.so.555.42.02
# /usr/lib/libnvidia-gpucomp.so.555.42.02
# /usr/lib/libnvidia-nvvm.so.4
# /usr/lib/libnvidia-nvvm.so.555.42.02
# /usr/lib/libnvidia-opencl.so.1
# /usr/lib/libnvidia-opencl.so.555.42.02
# /usr/lib/libnvidia-opticalflow.so.1
# /usr/lib/libnvidia-opticalflow.so.555.42.02
# /usr/lib/libnvidia-ptxjitcompiler.so.1
# /usr/lib/libnvidia-ptxjitcompiler.so.555.42.02
# --------------------------------
# Listing files for nvidia-driver-cuda-libs-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:26 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/libcuda.so
# /usr/lib64/libcuda.so.1
# /usr/lib64/libcuda.so.555.42.02
# /usr/lib64/libcudadebugger.so.1
# /usr/lib64/libcudadebugger.so.555.42.02
# /usr/lib64/libnvcuvid.so.1
# /usr/lib64/libnvcuvid.so.555.42.02
# /usr/lib64/libnvidia-encode.so.1
# /usr/lib64/libnvidia-encode.so.555.42.02
# /usr/lib64/libnvidia-gpucomp.so.555.42.02
# /usr/lib64/libnvidia-nvvm.so.4
# /usr/lib64/libnvidia-nvvm.so.555.42.02
# /usr/lib64/libnvidia-opencl.so.1
# /usr/lib64/libnvidia-opencl.so.555.42.02
# /usr/lib64/libnvidia-opticalflow.so.1
# /usr/lib64/libnvidia-opticalflow.so.555.42.02
# /usr/lib64/libnvidia-ptxjitcompiler.so.1
# /usr/lib64/libnvidia-ptxjitcompiler.so.555.42.02
# /usr/lib64/libnvidia-wayland-client.so.555.42.02
# --------------------------------
# Listing files for nvidia-driver-devel-3:555.42.02-1.el9.i686:
# Last metadata expiration check: 0:27:27 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib/libnvcuvid.so
# /usr/lib/libnvidia-encode.so
# /usr/lib/libnvidia-fbc.so
# /usr/lib/libnvidia-ml.so
# /usr/lib/libnvidia-nvvm.so
# /usr/lib/libnvidia-ptxjitcompiler.so
# --------------------------------
# Listing files for nvidia-driver-devel-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:29 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/libnvcuvid.so
# /usr/lib64/libnvidia-cfg.so
# /usr/lib64/libnvidia-encode.so
# /usr/lib64/libnvidia-fbc.so
# /usr/lib64/libnvidia-ml.so
# /usr/lib64/libnvidia-nvvm.so
# /usr/lib64/libnvidia-ptxjitcompiler.so
# --------------------------------
# Listing files for nvidia-driver-libs-3:555.42.02-1.el9.i686:
# Last metadata expiration check: 0:27:30 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib/libEGL_nvidia.so.0
# /usr/lib/libEGL_nvidia.so.555.42.02
# /usr/lib/libGLESv1_CM_nvidia.so.1
# /usr/lib/libGLESv1_CM_nvidia.so.555.42.02
# /usr/lib/libGLESv2_nvidia.so.2
# /usr/lib/libGLESv2_nvidia.so.555.42.02
# /usr/lib/libGLX_nvidia.so.0
# /usr/lib/libGLX_nvidia.so.555.42.02
# /usr/lib/libnvidia-allocator.so.1
# /usr/lib/libnvidia-allocator.so.555.42.02
# /usr/lib/libnvidia-eglcore.so.555.42.02
# /usr/lib/libnvidia-glcore.so.555.42.02
# /usr/lib/libnvidia-glsi.so.555.42.02
# /usr/lib/libnvidia-glvkspirv.so.555.42.02
# /usr/lib/libnvidia-tls.so.555.42.02
# /usr/lib/vdpau/libvdpau_nvidia.so.1
# /usr/lib/vdpau/libvdpau_nvidia.so.555.42.02
# --------------------------------
# Listing files for nvidia-driver-libs-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:31 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/gbm/nvidia-drm_gbm.so
# /usr/lib64/libEGL_nvidia.so.0
# /usr/lib64/libEGL_nvidia.so.555.42.02
# /usr/lib64/libGLESv1_CM_nvidia.so.1
# /usr/lib64/libGLESv1_CM_nvidia.so.555.42.02
# /usr/lib64/libGLESv2_nvidia.so.2
# /usr/lib64/libGLESv2_nvidia.so.555.42.02
# /usr/lib64/libGLX_nvidia.so.0
# /usr/lib64/libGLX_nvidia.so.555.42.02
# /usr/lib64/libnvidia-allocator.so.1
# /usr/lib64/libnvidia-allocator.so.555.42.02
# /usr/lib64/libnvidia-api.so.1
# /usr/lib64/libnvidia-cfg.so.1
# /usr/lib64/libnvidia-cfg.so.555.42.02
# /usr/lib64/libnvidia-egl-gbm.so.1
# /usr/lib64/libnvidia-egl-gbm.so.1.1.1
# /usr/lib64/libnvidia-eglcore.so.555.42.02
# /usr/lib64/libnvidia-glcore.so.555.42.02
# /usr/lib64/libnvidia-glsi.so.555.42.02
# /usr/lib64/libnvidia-glvkspirv.so.555.42.02
# /usr/lib64/libnvidia-ngx.so.1
# /usr/lib64/libnvidia-ngx.so.555.42.02
# /usr/lib64/libnvidia-pkcs11-openssl3.so.555.42.02
# /usr/lib64/libnvidia-pkcs11.so.555.42.02
# /usr/lib64/libnvidia-rtcore.so.555.42.02
# /usr/lib64/libnvidia-tls.so.555.42.02
# /usr/lib64/libnvoptix.so.1
# /usr/lib64/libnvoptix.so.555.42.02
# /usr/lib64/vdpau/libvdpau_nvidia.so.1
# /usr/lib64/vdpau/libvdpau_nvidia.so.555.42.02
# --------------------------------
# Listing files for nvidia-fabric-manager-0:555.42.02-1.x86_64:
# Last metadata expiration check: 0:27:32 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for nvidia-kmod-common-3:555.42.02-1.el9.noarch:
# Last metadata expiration check: 0:27:34 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for nvidia-kmod-headers-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:35 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/src/nvidia-555.42.02/Makefile
# --------------------------------
# Listing files for nvidia-libXNVCtrl-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:36 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/libXNVCtrl.so.0
# /usr/lib64/libXNVCtrl.so.0.0.0
# --------------------------------
# Listing files for nvidia-libXNVCtrl-devel-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:37 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/libXNVCtrl.so
# --------------------------------
# Listing files for nvidia-modprobe-3:555.42.02-2.el9.x86_64:
# Last metadata expiration check: 0:27:39 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for nvidia-persistenced-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:40 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------
# Listing files for nvidia-settings-3:555.42.02-1.el9.x86_64:
# Last metadata expiration check: 0:27:41 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# /usr/lib64/libnvidia-gtk3.so.555.42.02
# --------------------------------
# Listing files for nvidia-xconfig-3:555.42.02-2.el9.x86_64:
# Last metadata expiration check: 0:27:42 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# --------------------------------

```

从结果上看，nvidia-driver:latest-dkms 是核心驱动，有很多.so，内核模块 .ko 是临时编译出来的。

## cuda-toolkit

```bash
dnf info cuda-toolkit
# Name         : cuda-toolkit
# Version      : 12.5.0
# Release      : 1
# Architecture : x86_64
# Size         : 7.3 k
# Source       : cuda-toolkit-12.5.0-1.src.rpm
# Repository   : cuda-rhel9-x86_64
# Summary      : CUDA Toolkit meta-package
# URL          : http://nvidia.com
# License      : NVIDIA Proprietary
# Description  : Meta-package containing all runtime library packages and the CUDA driver.
#              : This meta package will install CUDA Toolkit version 12.5
#              : and also allows you to upgrade to next release.

dnf repoquery --list cuda-toolkit-12.5.0-1
# Package cuda-toolkit-12.5.0-1.x86_64 contains no files

dnf install cuda-toolkit
# Last metadata expiration check: 0:31:18 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# Dependencies resolved.
# ======================================================================================================================================================================================================
#  Package                                                   Architecture                     Version                                                 Repository                                   Size
# ======================================================================================================================================================================================================
# Installing:
#  cuda-toolkit                                              x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           7.3 k
# Installing dependencies:
#  cuda-cccl-12-5                                            x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           2.0 M
#  cuda-command-line-tools-12-5                              x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           7.4 k
#  cuda-compiler-12-5                                        x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           7.3 k
#  cuda-crt-12-5                                             x86_64                           12.5.40-1                                               cuda-rhel9-x86_64                           110 k
#  cuda-cudart-12-5                                          x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           225 k
#  cuda-cudart-devel-12-5                                    x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           2.0 M
#  cuda-cuobjdump-12-5                                       x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           283 k
#  cuda-cupti-12-5                                           x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            30 M
#  cuda-cuxxfilt-12-5                                        x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           281 k
#  cuda-documentation-12-5                                   x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           128 k
#  cuda-driver-devel-12-5                                    x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            43 k
#  cuda-gdb-12-5                                             x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            35 M
#  cuda-libraries-12-5                                       x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           7.6 k
#  cuda-libraries-devel-12-5                                 x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           7.8 k
#  cuda-nsight-12-5                                          x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           113 M
#  cuda-nsight-compute-12-5                                  x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           9.8 k
#  cuda-nsight-systems-12-5                                  x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           9.1 k
#  cuda-nvcc-12-5                                            x86_64                           12.5.40-1                                               cuda-rhel9-x86_64                            70 M
#  cuda-nvdisasm-12-5                                        x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            48 M
#  cuda-nvml-devel-12-5                                      x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           221 k
#  cuda-nvprof-12-5                                          x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           5.0 M
#  cuda-nvprune-12-5                                         x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            74 k
#  cuda-nvrtc-12-5                                           x86_64                           12.5.40-1                                               cuda-rhel9-x86_64                            24 M
#  cuda-nvrtc-devel-12-5                                     x86_64                           12.5.40-1                                               cuda-rhel9-x86_64                            27 M
#  cuda-nvtx-12-5                                            x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            88 k
#  cuda-nvvm-12-5                                            x86_64                           12.5.40-1                                               cuda-rhel9-x86_64                            26 M
#  cuda-nvvp-12-5                                            x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           115 M
#  cuda-opencl-12-5                                          x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            34 k
#  cuda-opencl-devel-12-5                                    x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           117 k
#  cuda-profiler-api-12-5                                    x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            26 k
#  cuda-sanitizer-12-5                                       x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                            18 M
#  cuda-toolkit-12-5                                         x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           8.7 k
#  cuda-toolkit-12-5-config-common                           noarch                           12.5.39-1                                               cuda-rhel9-x86_64                           7.7 k
#  cuda-toolkit-12-config-common                             noarch                           12.5.39-1                                               cuda-rhel9-x86_64                           7.9 k
#  cuda-toolkit-config-common                                noarch                           12.5.39-1                                               cuda-rhel9-x86_64                           7.9 k
#  cuda-tools-12-5                                           x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           7.2 k
#  cuda-visual-tools-12-5                                    x86_64                           12.5.0-1                                                cuda-rhel9-x86_64                           7.4 k
#  gds-tools-12-5                                            x86_64                           1.10.0.4-1                                              cuda-rhel9-x86_64                            42 M
#  java-11-openjdk                                           x86_64                           1:11.0.23.0.9-3.el9                                     appstream                                   434 k
#  java-11-openjdk-headless                                  x86_64                           1:11.0.23.0.9-3.el9                                     appstream                                    40 M
#  libcublas-12-5                                            x86_64                           12.5.2.13-1                                             cuda-rhel9-x86_64                           346 M
#  libcublas-devel-12-5                                      x86_64                           12.5.2.13-1                                             cuda-rhel9-x86_64                           402 M
#  libcufft-12-5                                             x86_64                           11.2.3.18-1                                             cuda-rhel9-x86_64                           183 M
#  libcufft-devel-12-5                                       x86_64                           11.2.3.18-1                                             cuda-rhel9-x86_64                           372 M
#  libcufile-12-5                                            x86_64                           1.10.0.4-1                                              cuda-rhel9-x86_64                           1.1 M
#  libcufile-devel-12-5                                      x86_64                           1.10.0.4-1                                              cuda-rhel9-x86_64                           4.8 M
#  libcurand-12-5                                            x86_64                           10.3.6.39-1                                             cuda-rhel9-x86_64                            53 M
#  libcurand-devel-12-5                                      x86_64                           10.3.6.39-1                                             cuda-rhel9-x86_64                            53 M
#  libcusolver-12-5                                          x86_64                           11.6.2.40-1                                             cuda-rhel9-x86_64                           124 M
#  libcusolver-devel-12-5                                    x86_64                           11.6.2.40-1                                             cuda-rhel9-x86_64                            84 M
#  libcusparse-12-5                                          x86_64                           12.4.1.24-1                                             cuda-rhel9-x86_64                           199 M
#  libcusparse-devel-12-5                                    x86_64                           12.4.1.24-1                                             cuda-rhel9-x86_64                           406 M
#  libnpp-12-5                                               x86_64                           12.3.0.116-1                                            cuda-rhel9-x86_64                           155 M
#  libnpp-devel-12-5                                         x86_64                           12.3.0.116-1                                            cuda-rhel9-x86_64                           152 M
#  libnvfatbin-12-5                                          x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           925 k
#  libnvfatbin-devel-12-5                                    x86_64                           12.5.39-1                                               cuda-rhel9-x86_64                           838 k
#  libnvjitlink-12-5                                         x86_64                           12.5.40-1                                               cuda-rhel9-x86_64                            20 M
#  libnvjitlink-devel-12-5                                   x86_64                           12.5.40-1                                               cuda-rhel9-x86_64                            23 M
#  libnvjpeg-12-5                                            x86_64                           12.3.2.38-1                                             cuda-rhel9-x86_64                           3.3 M
#  libnvjpeg-devel-12-5                                      x86_64                           12.3.2.38-1                                             cuda-rhel9-x86_64                           3.1 M
#  libxkbcommon-x11                                          x86_64                           1.0.3-4.el9                                             appstream                                    21 k
#  nsight-compute-2024.2.0                                   x86_64                           2024.2.0.16-1                                           cuda-rhel9-x86_64                           531 M
#  nsight-systems-2024.2.3                                   x86_64                           2024.2.3.38_242334140272v0-0                            cuda-rhel9-x86_64                           326 M
#  ttmkfdir                                                  x86_64                           3.0.9-65.el9                                            appstream                                    52 k
#  xcb-util                                                  x86_64                           0.4.0-19.el9                                            appstream                                    18 k
#  xcb-util-image                                            x86_64                           0.4.0-19.el9.0.1                                        appstream                                    18 k
#  xcb-util-keysyms                                          x86_64                           0.4.0-17.el9                                            appstream                                    14 k
#  xcb-util-renderutil                                       x86_64                           0.3.9-20.el9.0.1                                        appstream                                    16 k
#  xcb-util-wm                                               x86_64                           0.4.1-22.el9                                            appstream                                    31 k
#  xorg-x11-fonts-Type1                                      noarch                           7.5-33.el9                                              appstream                                   499 k

# Transaction Summary
# ======================================================================================================================================================================================================
# Install  71 Packages

# Total download size: 3.9 G
# Installed size: 7.3 G

```

## nvidia-gds

```bash
dnf info nvidia-gds
# Last metadata expiration check: 0:36:27 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# Available Packages
# Name         : nvidia-gds
# Version      : 12.5.0
# Release      : 1
# Architecture : x86_64
# Size         : 7.2 k
# Source       : nvidia-gds-12.5.0-1.src.rpm
# Repository   : cuda-rhel9-x86_64
# Summary      : GPU Direct Storage meta-package
# URL          : http://nvidia.com
# License      : NVIDIA Proprietary
# Description  : Meta-package for GPU Direct Storage containing all the available packages required for libcufile and nvidia-fs.


dnf repoquery --list nvidia-gds-12.5.0-1
# Last metadata expiration check: 0:36:55 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# Package nvidia-gds-12.5.0-1.x86_64 contains no files

dnf install nvidia-gds-12.5.0-1
# Last metadata expiration check: 0:37:27 ago on Thu 27 Jun 2024 11:16:59 AM UTC.
# Dependencies resolved.
# ======================================================================================================================================================================================================
#  Package                                                     Architecture                       Version                                           Repository                                     Size
# ======================================================================================================================================================================================================
# Installing:
#  kernel-devel                                                x86_64                             5.14.0-427.22.1.el9_4                             appstream                                      21 M
#  nvidia-gds                                                  x86_64                             12.5.0-1                                          cuda-rhel9-x86_64                             7.2 k
# Installing dependencies:
#  cuda-toolkit-12-5-config-common                             noarch                             12.5.39-1                                         cuda-rhel9-x86_64                             7.7 k
#  cuda-toolkit-12-config-common                               noarch                             12.5.39-1                                         cuda-rhel9-x86_64                             7.9 k
#  cuda-toolkit-config-common                                  noarch                             12.5.39-1                                         cuda-rhel9-x86_64                             7.9 k
#  dkms                                                        noarch                             3.0.13-1.el9                                      epel                                           82 k
#  dnf-plugin-nvidia                                           noarch                             2.1-2.el9                                         cuda-rhel9-x86_64                              13 k
#  egl-wayland                                                 x86_64                             1.1.9-2.el9                                       appstream                                      36 k
#  gds-tools-12-5                                              x86_64                             1.10.0.4-1                                        cuda-rhel9-x86_64                              42 M
#  kernel-core                                                 x86_64                             5.14.0-427.22.1.el9_4                             baseos                                         20 M
#  kernel-devel-matched                                        x86_64                             5.14.0-427.22.1.el9_4                             appstream                                     5.3 M
#  kernel-modules-core                                         x86_64                             5.14.0-427.22.1.el9_4                             baseos                                         33 M
#  kmod-nvidia-latest-dkms                                     x86_64                             3:555.42.02-1.el9                                 cuda-rhel9-x86_64                              40 M
#  libXdmcp                                                    x86_64                             1.1.3-8.el9                                       appstream                                      35 k
#  libXfont2                                                   x86_64                             2.0.3-12.el9                                      appstream                                     143 k
#  libcufile-12-5                                              x86_64                             1.10.0.4-1                                        cuda-rhel9-x86_64                             1.1 M
#  libcufile-devel-12-5                                        x86_64                             1.10.0.4-1                                        cuda-rhel9-x86_64                             4.8 M
#  libevdev                                                    x86_64                             1.11.0-3.el9                                      appstream                                      45 k
#  libinput                                                    x86_64                             1.19.3-4.el9_2                                    appstream                                     194 k
#  libvdpau                                                    x86_64                             1.5-1.el9                                         appstream                                      16 k
#  libwacom                                                    x86_64                             1.12.1-2.el9                                      appstream                                      45 k
#  libwacom-data                                               noarch                             1.12.1-2.el9                                      appstream                                     104 k
#  libxkbfile                                                  x86_64                             1.1.0-8.el9                                       appstream                                      88 k
#  mesa-vulkan-drivers                                         x86_64                             23.3.3-1.el9                                      appstream                                     9.7 M
#  mtdev                                                       x86_64                             1.1.5-22.el9                                      appstream                                      21 k
#  nvidia-driver                                               x86_64                             3:555.42.02-1.el9                                 cuda-rhel9-x86_64                             126 M
#  nvidia-driver-cuda-libs                                     x86_64                             3:555.42.02-1.el9                                 cuda-rhel9-x86_64                              50 M
#  nvidia-driver-libs                                          x86_64                             3:555.42.02-1.el9                                 cuda-rhel9-x86_64                             136 M
#  nvidia-fs                                                   x86_64                             2.20.5-1                                          cuda-rhel9-x86_64                             7.3 k
#  nvidia-fs-dkms                                              x86_64                             2.20.5-1                                          cuda-rhel9-x86_64                              84 k
#  nvidia-gds-12-5                                             x86_64                             12.5.0-1                                          cuda-rhel9-x86_64                             7.3 k
#  nvidia-kmod-common                                          noarch                             3:555.42.02-1.el9                                 cuda-rhel9-x86_64                              12 k
#  vulkan-loader                                               x86_64                             1.3.268.0-1.el9                                   appstream                                     144 k
#  xkbcomp                                                     x86_64                             1.4.4-4.el9                                       appstream                                      99 k
#  xorg-x11-drv-libinput                                       x86_64                             1.0.1-3.el9                                       appstream                                      45 k
#  xorg-x11-server-Xorg                                        x86_64                             1.20.11-24.el9                                    appstream                                     1.5 M
#  xorg-x11-server-common                                      x86_64                             1.20.11-24.el9                                    appstream                                      35 k
# Enabling module streams:
#  nvidia-driver                                                                                  latest-dkms

# Transaction Summary
# ======================================================================================================================================================================================================
# Install  37 Packages

# Total download size: 491 M
# Installed size: 1.1 G


```

nvidia-gds 又是一个壳rpm，本身没东西，但是有依赖，不过值得注意的是，他依赖的几个内核模块的包。


## nvidia-container-toolkit

为了在OS上支持容器运行时，[nvidia提供了nvidia-container-toolkit](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html)，这个工具包含了一些工具，比如nvidia-container-cli，nvidia-container-runtime，nvidia-docker等。他实际上是提供了容器运行时的plugin，让容器运行时可以控制对gpu的访问。

```bash
curl -s -L https://nvidia.github.io/libnvidia-container/stable/rpm/nvidia-container-toolkit.repo | \
  sudo tee /etc/yum.repos.d/nvidia-container-toolkit.repo
# [nvidia-container-toolkit]
# name=nvidia-container-toolkit
# baseurl=https://nvidia.github.io/libnvidia-container/stable/rpm/$basearch
# repo_gpgcheck=1
# gpgcheck=0
# enabled=1
# gpgkey=https://nvidia.github.io/libnvidia-container/gpgkey
# sslverify=1
# sslcacert=/etc/pki/tls/certs/ca-bundle.crt

# [nvidia-container-toolkit-experimental]
# name=nvidia-container-toolkit-experimental
# baseurl=https://nvidia.github.io/libnvidia-container/experimental/rpm/$basearch
# repo_gpgcheck=1
# gpgcheck=0
# enabled=0
# gpgkey=https://nvidia.github.io/libnvidia-container/gpgkey
# sslverify=1
# sslcacert=/etc/pki/tls/certs/ca-bundle.crt


dnf install nvidia-container-toolkit
# Dependencies resolved.
# ====================================================================================================================================================================================================== Package                                                      Architecture                          Version                                    Repository                                        Size
# ======================================================================================================================================================================================================Installing:
#  nvidia-container-toolkit                                     x86_64                                1.15.0-1                                   cuda-rhel9-x86_64                                1.0 M
# Installing dependencies:
#  libnvidia-container-tools                                    x86_64                                1.15.0-1                                   cuda-rhel9-x86_64                                 39 k
#  libnvidia-container1                                         x86_64                                1.15.0-1                                   cuda-rhel9-x86_64                                1.0 M
#  nvidia-container-toolkit-base                                x86_64                                1.15.0-1                                   cuda-rhel9-x86_64                                3.5 M

# Transaction Summary
# ======================================================================================================================================================================================================Install  4 Packages

# Total download size: 5.6 M
# Installed size: 17 M

artifacts=(
"nvidia-container-toolkit"
"libnvidia-container-tools "
"libnvidia-container1"
"nvidia-container-toolkit-base"
)

for artifact in "${artifacts[@]}"; do
    echo "Listing files for $artifact:"
    dnf repoquery --list $artifact | grep -E "\.(so.*)$|bin"
    # dnf repoquery --list $artifact 
    echo "--------------------------------"
done

# Listing files for nvidia-container-toolkit:
# Last metadata expiration check: 2:45:14 ago on Thu 27 Jun 2024 01:10:52 PM UTC.
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# /usr/bin/nvidia-container-runtime-hook
# --------------------------------
# Listing files for libnvidia-container-tools :
# Last metadata expiration check: 2:45:15 ago on Thu 27 Jun 2024 01:10:52 PM UTC.
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# /usr/bin/nvidia-container-cli
# --------------------------------
# Listing files for libnvidia-container1:
# Last metadata expiration check: 2:45:16 ago on Thu 27 Jun 2024 01:10:52 PM UTC.
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.13.2
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.13.2
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.13.0
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.13.0
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.13.3
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.13.3
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.13.5
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.13.5
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.13.4
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.13.4
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.13.1
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.13.1
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.14.0
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.14.0
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.14.1
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.14.1
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.14.2
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.14.2
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.14.3
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.14.3
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.14.4
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.14.4
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.14.5
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.14.5
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.14.6
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.14.6
# /usr/lib64/libnvidia-container-go.so.1
# /usr/lib64/libnvidia-container-go.so.1.15.0
# /usr/lib64/libnvidia-container.so.1
# /usr/lib64/libnvidia-container.so.1.15.0
# --------------------------------
# Listing files for nvidia-container-toolkit-base:
# Last metadata expiration check: 2:45:18 ago on Thu 27 Jun 2024 01:10:52 PM UTC.
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# /usr/bin/nvidia-container-runtime
# /usr/bin/nvidia-ctk
# --------------------------------


```

## 总结

我们认为，nvidia官方的包里面，内核相关的rpm，以及container相关的rpm，是宿主机上面要按照的，这个里面有内核模块，而其他的都是应用层相关的，装在容器镜像里面就可以。

接下来，我们就尝试一下，如何在 os 上做最小化安装，就能够支持在os上允许gpu的容器化应用。

(以下内容，还没有实际测试，要等待环境具备，作者才能试一试)
```bash
dnf config-manager --add-repo https://developer.download.nvidia.com/compute/cuda/repos/rhel9/x86_64/cuda-rhel9.repo

# dnf module install nvidia-driver:latest-dkms
dnf install -y kmod-nvidia-latest-dkms

dnf install -y cuda-toolkit
# dnf install nvidia-gds


# try cuda container apps
# https://catalog.ngc.nvidia.com/orgs/nvidia/teams/k8s/containers/cuda-sample
docker run --rm --gpus all nvcr.io/nvidia/k8s/cuda-sample:vectoradd-cuda11.7.1-ubi8

```


# 容器平台上安装分析

要分析清楚这些，我们就要先从nvidia的gpu operator说起。我们查看nvidia gpu operator的官网。




# env


- https://github.com/NVIDIA/gpu-driver-container/blob/main/rhel9/nvidia-driver
- https://github.com/NVIDIA/nvidia-container-toolkit/tree/main
- https://docs.nvidia.com/datacenter/cloud-native/gpu-operator/latest/index.html
- https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html
- https://docs.nvidia.com/cuda/cuda-installation-guide-linux/#prepare-rhel-9-rocky-9