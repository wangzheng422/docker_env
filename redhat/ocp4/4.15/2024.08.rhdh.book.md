# rhdh for book

- https://github.com/developer-hub-books/rhdh-book1-templates

# install gitlab

```bash

oc new-project demo-gitlab

mkdir -p ${BASE_DIR}/data/git

cd ${BASE_DIR}/data/git

# git clone https://github.com/redhat-gpte-devopsautomation/agnosticg.git
git clone --branch wzh https://github.com/wangzheng422/agnosticg

cd agnosticg/charts/gitlab/

cat << EOF > ./values.yaml
gitlab:
  email:
    address: "gitlab@example.com"
    displayName: "wzh"
    replyTo: "noreply@wzhlab.top"
  smtp:
    enabled: "false"
    domain: "example.com"
    host: "smtp.gitlab-demo-gitlab.apps.demo-01-rhsys.wzhlab.top"
    port: "587"
    user: "gitlab"
    password: "gitlab"
  ssh:
    host: "ssh.gitlab-demo-gitlab.apps.demo-01-rhsys.wzhlab.top"
    port: "22"
  rootPassword: openshift
  host: gitlab-demo-gitlab.apps.demo-01-rhsys.wzhlab.top
  https: "true"
  rootEmail: "admin@wzhlab.top"
  keyBase:
    db: "0123456789"
    otp: "0123456789"
    secret: "0123456789"
  users:
    password: openshift
    count: 2
  groups: []
  # groups:
  # - name: backstage
  #   repo:
  #   - name: software-templates
  #     url: https://github.com/treddy08/software-templates.git

postgresql:
  dbUser: gitlab
  dbPassword: passw0rd
  dbName: gitlab_production

EOF

oc delete rolebinding admin --namespace demo-gitlab

helm install gitlab . --namespace demo-gitlab
# NAME: gitlab
# LAST DEPLOYED: Mon Aug 12 21:38:23 2024
# NAMESPACE: demo-gitlab
# STATUS: deployed
# REVISION: 1
# TEST SUITE: None

# if you want to remove the gitlab deployment
# helm uninstall gitlab --namespace demo-gitlab

```

# install rhdh

Create a new namespace for rhdh deployment.

```bash
oc new-project demo-rhdh
```
![](../4.16/imgs/2024.08.rhdh.book.md/2024-08-12-14-59-42.png)

![](../4.16/imgs/2024.08.rhdh.book.md/2024-08-12-15-01-13.png)

![](../4.16/imgs/2024.08.rhdh.book.md/2024-08-12-15-46-01.png)

# config rhdh

```bash

cat << EOF > ${BASE_DIR}/data/install/app-config-rhdh.yaml
---
kind: ConfigMap
apiVersion: v1
metadata:
  name: app-config-rhdh
data:
  app-config-rhdh.yaml: |
    app:
      title: {product}

EOF


```


# end


# install gitlab

- https://www.redhat.com/en/blog/install-the-gitlab-operator-on-openshift

![](imgs/2024.08.rhdh.book.md/2024-08-12-19-56-49.png)

```bash
# it will installed in gitlab-system namespace.

cat << EOF > ${BASE_DIR}/data/install/gitlab-scc.yaml
apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: gitlab-nginx-ingress-scc
priority: null

# Host-related settings
allowHostDirVolumePlugin: false  # Disallow host directory volume plugins
allowHostIPC: false                # Disallow IPC namespace sharing with the host
allowHostNetwork: false            # Disallow host network sharing
allowHostPID: false                # Disallow host PID namespace sharing
allowHostPorts: false              # Disallow host port usage

# Privilege settings
allowPrivilegeEscalation: true     # Allow privilege escalation
allowPrivilegedContainer: false     # Disallow privileged containers

# Capabilities configuration
allowedCapabilities: null           # No additional capabilities allowed
defaultAddCapabilities:             # Default capabilities added
  - NET_BIND_SERVICE                # Allow binding to privileged ports

# File system group settings
fsGroup:
  type: MustRunAs                   # fsGroup must be set

# User and SELinux settings
runAsUser:
  type: MustRunAs                   # User must run as specified UID
  uid: 101                          # User ID (UID) to run as
seLinuxContext:
  type: MustRunAs                   # SELinux context must be set

# Additional configuration
groups: []                          # No specific groups required
readOnlyRootFilesystem: false       # Root filesystem is not read-only
requiredDropCapabilities:           # Capabilities that must be dropped
  - ALL                             # Drop all capabilities
EOF

oc create -f ${BASE_DIR}/data/install/gitlab-scc.yaml


cat << EOF > ${BASE_DIR}/data/install/gitlab-values.yaml
apiVersion: networking.k8s.io/v1
kind: IngressClass
metadata:
  # Ensure this value matches 'spec.chart.values.global.ingress.class'
  # in the GitLab CR on the next step.
  name: gitlab-nginx
spec:
  controller: k8s.io/ingress-nginx
EOF

oc create -f ${BASE_DIR}/data/install/gitlab-values.yaml

```

![](imgs/2024.08.rhdh.book.md/2024-08-12-18-19-13.png)

![](imgs/2024.08.rhdh.book.md/2024-08-12-20-00-46.png)

<!-- ![](imgs/2024.08.rhdh.book.md/2024-08-12-20-22-49.png) -->
<img src="imgs/2024.08.rhdh.book.md/2024-08-12-20-22-49.png" style="height:400px;">


```bash
oc -n gitlab-system get ing
# NAME                        CLASS          HOSTS                                               ADDRESS   PORTS     AGE
# gitlab-kas                  gitlab-nginx   kas.gitlab-wzh.apps.demo-01-rhsys.wzhlab.top                  80, 443   3m34s
# gitlab-minio                gitlab-nginx   minio.gitlab-wzh.apps.demo-01-rhsys.wzhlab.top                80, 443   4m5s
# gitlab-registry             gitlab-nginx   registry.gitlab-wzh.apps.demo-01-rhsys.wzhlab.top             80, 443   3m34s
# gitlab-webservice-default   gitlab-nginx   gitlab.gitlab-wzh.apps.demo-01-rhsys.wzhlab.top               80, 443   3m33s
```

open browser with: 
`https://gitlab.gitlab-wzh.apps.demo-01-rhsys.wzhlab.top`

# end